jQuery.webshims.register("track",function(g,d,o,p){var i=d.mediaelement;(new Date).getTime();var r={subtitles:1,captions:1},m=function(a){var b={};a.addEventListener=function(a,h){b[a]&&d.error("always use $.bind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+h);b[a]=h};a.removeEventListener=function(a,h){b[a]&&b[a]!=h&&d.error("always use $.bind/$.unbind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+h);b[a]&&delete b[a]};return a},s={getCueById:function(a){for(var b=
null,e=0,h=this.length;e<h;e++)if(this[e].id===a){b=this[e];break}return b}},t={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:"disabled",readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(this.cues){var b=this.cues[this.cues.length-1];b&&b.startTime>a.startTime&&d.error("cue startTime higher than previous cue's startTime")}else this.cues=i.createCueList();a.track&&d.error("cue already part of a track element");
a.track=this;this.cues.push(a)},removeCue:function(){d.error("not implemented yet")},DISABLED:"disabled",OFF:"disabled",HIDDEN:"hidden",SHOWING:"showing",ERROR:3,LOADED:2,LOADING:1,NONE:0},u=["kind","label","srclang"],v=Function.prototype.call.bind(Object.prototype.hasOwnProperty),j=function(a,b){var e=[],h=[],c=[],f,k;a||(a=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{}));if(!b)a.blockTrackListUpdate=!0,b=g.prop(this,"textTracks"),a.blockTrackListUpdate=!1;clearTimeout(a.updateTrackListTimer);
g("track",this).each(function(){var a=g.prop(this,"track");c.push(a);-1==b.indexOf(a)&&h.push(a)});if(a.scriptedTextTracks)for(f=0,k=a.scriptedTextTracks.length;f<k;f++)c.push(a.scriptedTextTracks[f]),-1==b.indexOf(a.scriptedTextTracks[f])&&h.push(a.scriptedTextTracks[f]);for(f=0,k=b.length;f<k;f++)-1==c.indexOf(b[f])&&e.push(b[f]);if(e.length||h.length){b.splice(0);for(f=0,k=c.length;f<k;f++)b.push(c[f]);for(f=0,k=e.length;f<k;f++)g([b]).triggerHandler(g.Event({type:"removetrack",track:b,track:e[f]}));
for(f=0,k=h.length;f<k;f++)g([b]).triggerHandler(g.Event({type:"addtrack",track:b,track:h[f]}));(a.scriptedTextTracks||e.length)&&g(this).triggerHandler("updatetrackdisplay")}},q=function(a,b){var e,h;b||(b=d.data(a,"trackData"));if(b&&!b.isTriggering)b.isTriggering=!0,e=(b.track||{}).mode,h=(b.track||{}).kind,setTimeout(function(){if(e!==(b.track||{}).mode||h!=(b.track||{}).kind)(b.track||{}).readyState?g(a).parent().triggerHandler("updatetrackdisplay"):g(a).triggerHandler("checktrackmode");b.isTriggering=
!1},9)},n=g("<div />")[0];o.TextTrackCue=function(a,b,e){3!=arguments.length&&d.error("wrong arguments.length for TextTrackCue.constructor");this.startTime=a;this.endTime=b;this.text=e;this.id="";this.pauseOnExit=!1;m(this)};o.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a="",b="",e=p.createDocumentFragment(),h;if(!v(this,"getCueAsHTML"))h=this.getCueAsHTML=function(){var c,f;if(a!=this.text){a=this.text;b=i.parseCueTextToHTML(a);n.innerHTML=b;for(c=
0,f=n.childNodes.length;c<f;c++)e.appendChild(n.childNodes[c].cloneNode(!0))}return e.cloneNode(!0)};return h?h.apply(this,arguments):e.cloneNode(!0)},track:null,id:""};i.createCueList=function(){return g.extend([],s)};i.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/ig,b=/^(?:c|v|ruby|rt|b|i|u)/,e=/\<\s*\//,h=function(a,b,c,h){e.test(h)?a="</"+a+">":(c.splice(0,1),a="<"+a+" "+b+'="'+c.join(" ").replace(/\"/g,"&#34;")+'">');return a},c=function(a){var c=a.replace(/[<\/>]+/ig,"").split(/[\s\.]+/);
c[0]&&(c[0]=c[0].toLowerCase(),b.test(c[0])?"c"==c[0]?a=h("span","class",c,a):"v"==c[0]&&(a=h("q","title",c,a)):a="");return a};return function(b){return b.replace(a,c)}}();i.loadTextTrack=function(a,b,e,h){var c=e.track,f=function(){var h=g.prop(b,"src"),e,l;if("disabled"!=c.mode&&h&&g.attr(b,"src")&&(g(a).unbind("play playing timeupdate updatetrackdisplay",f),g(b).unbind("checktrackmode",f),!c.readyState)){e=function(){c.readyState=3;c.cues=null;c.activeCues=c.shimActiveCues=c._shimActiveCues=null;
g(b).triggerHandler("error")};c.readyState=1;try{c.cues=i.createCueList(),c.activeCues=c.shimActiveCues=c._shimActiveCues=i.createCueList(),l=g.ajax({dataType:"text",url:h,success:function(f){"text/vtt"!=l.getResponseHeader("content-type")&&d.error("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt");i.parseCaptions(f,c,function(f){f&&"length"in f?(c.readyState=2,g(b).triggerHandler("load"),g(a).triggerHandler("updatetrackdisplay")):e()})},error:e})}catch(j){e(),
d.warn(j)}}};c.readyState=0;c.shimActiveCues=null;c._shimActiveCues=null;c.activeCues=null;c.cues=null;g(a).unbind("play playing timeupdate updatetrackdisplay",f);g(b).unbind("checktrackmode",f);g(a).bind("play playing timeupdate updatetrackdisplay",f);g(b).bind("checktrackmode",f);if(h)c.mode=r[c.kind]?"showing":"hidden",f()};i.createTextTrack=function(a,b){var e,h;if(b.nodeName&&(h=d.data(b,"trackData")))q(b,h),e=h.track;if(!e)e=m(d.objectCreate(t)),u.forEach(function(a){var f=g.prop(b,a);f&&("srclang"==
a&&(a="language"),e[a]=f)}),b.nodeName?(h=d.data(b,"trackData",{track:e}),i.loadTextTrack(a,b,h,g.prop(b,"default"))):(e.cues=i.createCueList(),e.activeCues=e._shimActiveCues=e.shimActiveCues=i.createCueList(),e.mode="hidden",e.readyState=2);return e};i.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,b=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,e=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,h=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;
return function(c){var f,d,g,i;if(b.exec(c)||e.exec(c)||h.exec(c))return null;for(c=c.split(/\n/g);!c[0].replace(/\s+/ig,"").length&&0<c.length;)c.shift();for(c[0].match(/^\s*[a-z0-9]+\s*$/ig)&&(g=""+c.shift().replace(/\s*/ig,""));0<c.length;){if(i=a.exec(c[0]))d=i.slice(1),f=parseInt(3600*(d[0]||0),10)+parseInt(60*(d[1]||0),10)+parseInt(d[2]||0,10)+parseFloat("0."+(d[3]||0)),d=parseInt(3600*(d[4]||0),10)+parseInt(60*(d[5]||0),10)+parseInt(d[6]||0,10)+parseFloat("0."+(d[7]||0));c=c.slice(0,0).concat(c.slice(1));
break}if(!f&&!d)return null;c=c.join("\n");f=new TextTrackCue(f,d,c);if(g)f.id=g;return f}}();i.parseCaptions=function(a,b,e){i.createCueList();var h,c,f,g,j;a?(f=/^WEBVTT(\s*FILE)?/ig,c=function(l,m){for(;l<m;l++){h=a[l];if(f.test(h))j=!0;else if(h.replace(/\s*/ig,"").length){if(!j){d.error("please use WebVTT format. This is the standard");e(null);break}(h=i.parseCaptionChunk(h,l))&&b.addCue(h)}if(g<(new Date).getTime()-9){l++;setTimeout(function(){g=(new Date).getTime();c(l,m)},90);break}}l>=m&&
(j||d.error("please use WebVTT format. This is the standard"),e(b.cues))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n");setTimeout(function(){g=(new Date).getTime();a=a.split(/\n\n+/g);c(0,a.length)},9)},9)):d.error("Required parameter captionData not supplied.")};i.createTrackList=function(a,b){b=b||d.data(a,"mediaelementBase")||d.data(a,"mediaelementBase",{});if(!b.textTracks)b.textTracks=[],d.defineProperties(b.textTracks,{onaddtrack:{value:null},onremovetrack:{value:null}}),
m(b.textTracks);return b.textTracks};Modernizr.track||(d.defineNodeNamesBooleanProperty(["track"],"default"),d.reflectProperties(["track"],["srclang","label"]),d.defineNodeNameProperties("track",{src:{reflect:!0,propType:"src"}}));d.defineNodeNameProperties("track",{kind:{attr:Modernizr.track?{set:function(a){var b=d.data(this,"trackData");this.setAttribute("data-kind",a);if(b)b.attrKind=a},get:function(){var a=d.data(this,"trackData");return a&&"attrKind"in a?a.attrKind:this.getAttribute("kind")}}:
{},reflect:!0,propType:"enumarated",defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]}});d.onNodeNamesPropertyModify("track","kind",function(){var a=d.data(this,"trackData");if(a)a.track.kind=g.prop(this,"kind"),q(this,a)});d.onNodeNamesPropertyModify("track","src",function(a){if(a){var a=d.data(this,"trackData"),b;a&&(b=g(this).closest("video, audio"),b[0]&&i.loadTextTrack(b,this,a))}});d.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},
LOADING:{value:1},NONE:{value:0},readyState:{get:function(){return(g.prop(this,"track")||{readyState:0}).readyState},writeable:!1},track:{get:function(){return i.createTextTrack(g(this).closest("audio, video")[0],this)},writeable:!1}},"prop");d.defineNodeNamesProperties(["audio","video"],{textTracks:{get:function(){var a=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{}),b=i.createTrackList(this,a);a.blockTrackListUpdate||j.call(this,a,b);return b},writeable:!1},addTextTrack:{value:function(a,
b,e){a=i.createTextTrack(this,{kind:a||"",label:b||"",srclang:e||""});b=d.data(this,"mediaelementBase")||d.data(this,"mediaelementBase",{});if(!b.scriptedTextTracks)b.scriptedTextTracks=[];b.scriptedTextTracks.push(a);j.call(this);return a}}},"prop");g(p).bind("emptied ended updatetracklist",function(a){if(g(a.target).is("audio, video")){var b=d.data(a.target,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a.target,b)},0)}});d.addReady(function(a,
b){var e=b.filter("video, audio, track").closest("audio, video");g("video, audio",a).add(e).each(function(){j.call(this)}).each(function(){if(Modernizr.track){var a=this.textTracks;g.prop(this,"textTracks").length!=a.length&&d.error("textTracks couldn't be copied");g("track",this).each(function(){var a=g.prop(this,"track"),b=this.track,d,e;if(b){d=g.prop(this,"kind");e=b.readyState||this.readyState;if(b.mode||e)a.mode=b.mode;if("descriptions"!=d)b.mode="string"==typeof b.mode?"disabled":0,this.kind=
"metadata",g(this).attr({kind:d})}}).bind("load error",function(a){a.originalEvent&&a.stopImmediatePropagation()})}});e.each(function(){var a=this,b=d.data(a,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a,b)},9)})});Modernizr.track&&g("video, audio").trigger("trackapichange")});
